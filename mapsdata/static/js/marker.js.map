{
  "version": 3,
  "sources": ["../../src/ts/marker.ts"],
  "sourcesContent": ["interface NaturalDimensions {\n    naturalWidth: number;\n    naturalHeight: number;\n}\n\ninterface RealDimensions {\n    width: number;\n    height: number;\n}\n\ninterface ElementPaddings {\n    leftPadding: number;\n    topPadding: number;\n}\n\nconst getElementNaturalDimensions = (element: HTMLImageElement): NaturalDimensions => {\n    const { naturalHeight, naturalWidth } = element;\n\n    return {\n        naturalHeight,\n        naturalWidth,\n    };\n};\n\nconst getElementRealDimensions = (element: HTMLElement): RealDimensions => {\n    const { width, height } = element.getBoundingClientRect();\n\n    return {\n        width,\n        height,\n    };\n};\n\nconst getImageWrapperPaddings = (mapId: string): ElementPaddings => {\n    const imageWrapper = document.getElementById(`map-imagewrapper-${mapId}`);\n\n    if (!(imageWrapper instanceof HTMLDivElement)) {\n        throw new Error(`Image wrapper missing for mapId: ${mapId}`);\n    }\n\n    const leftPadding = parseInt(\n        window.getComputedStyle(imageWrapper).getPropertyValue('padding-left').replace('px', ''),\n    );\n\n    const topPadding = parseInt(\n        window.getComputedStyle(imageWrapper).getPropertyValue('padding-top').replace('px', ''),\n    );\n\n    return {\n        leftPadding,\n        topPadding,\n    };\n};\n\nconst clamp = (num: number, min: number, max: number): number => Math.min(Math.max(num, min), max);\n\nconst placeImageMarker = (mapId: string): void => {\n    const mapElement = document.getElementById(`map-image-${mapId}`);\n    const markerElement = document.getElementById(`map-marker-${mapId}`);\n\n    if (mapElement instanceof HTMLImageElement && markerElement instanceof HTMLElement) {\n        const mapNaturalDimensions = getElementNaturalDimensions(mapElement);\n        const mapRealDimensions = getElementRealDimensions(mapElement);\n\n        const markerRealDimensions = getElementRealDimensions(markerElement);\n\n        const { leftPadding, topPadding } = getImageWrapperPaddings(mapId);\n\n        const { markerx, markery } = markerElement.dataset;\n\n        if (markerx && markery) {\n            const markerRelativeX =\n                Math.round(\n                    (parseInt(markerx) * mapRealDimensions.width) /\n                        mapNaturalDimensions.naturalWidth -\n                        markerRealDimensions.width / 2,\n                ) + leftPadding;\n\n            const markerRelativeY =\n                Math.round(\n                    (parseInt(markery) * mapRealDimensions.height) /\n                        mapNaturalDimensions.naturalHeight -\n                        markerRealDimensions.height,\n                ) + topPadding;\n\n            markerElement.style.top = `${markerRelativeY}px`;\n            markerElement.style.left = `${markerRelativeX}px`;\n\n            markerElement.classList.remove('opacity-0');\n            markerElement.classList.add('opacity-90');\n        } else {\n            throw new Error('Marker coordinates not provided');\n        }\n    } else {\n        throw new Error('Invalid Map or Marker element');\n    }\n};\n\nconst getMapId = (text: string): string => {\n    const lastKebabCaseItem = text.split('-').slice(-1);\n\n    if (lastKebabCaseItem[0]) {\n        return lastKebabCaseItem[0];\n    }\n\n    throw new Error('Map ID not found');\n};\n\nconst handleMapSelectorChange = (event: Event) => {\n    const target = event.target as HTMLElement; // Assumption that event.target exists\n    const mapId = getMapId(target.id);\n\n    const mapWrappers = document.querySelectorAll('[id^=map-imagewrapper-]');\n\n    // Hide all maps\n    mapWrappers.forEach((mapWrapper) => {\n        if (!mapWrapper.classList.contains('hidden')) {\n            mapWrapper.classList.add('hidden');\n        }\n    });\n\n    // Remove hidden from selected Map\n    const selectedImageWrapper = document.getElementById(`map-imagewrapper-${mapId}`);\n    if (selectedImageWrapper) {\n        selectedImageWrapper.classList.remove('hidden');\n    }\n\n    // Place Marker in Selected Map\n    placeImageMarker(mapId);\n};\n\nconst setMapSelectorListeners = () => {\n    const mapButtons = document.querySelectorAll('input[name=\"map-selector\"]');\n    const mapButtonSpans = document.querySelectorAll('input[name=\"map-selector\"]~span');\n\n    mapButtons.forEach((element) => {\n        if (!(element instanceof HTMLInputElement)) {\n            throw new Error('Map Input has unexpected type');\n        }\n\n        element.addEventListener('change', (event) => {\n            handleMapSelectorChange(event);\n        });\n    });\n\n    mapButtonSpans.forEach((element) => {\n        if (!(element instanceof HTMLSpanElement)) {\n            throw new Error('Map button has unexpected type');\n        }\n\n        element.addEventListener('keydown', (event) => {\n            const { key } = event;\n\n            if (key === 'Enter') {\n                const inputSibling = element.previousElementSibling;\n\n                if (!(inputSibling instanceof HTMLInputElement)) {\n                    throw new Error('Map Button input element missing');\n                }\n\n                inputSibling.checked = true;\n\n                const changeEvent = new Event('change');\n                inputSibling.dispatchEvent(changeEvent);\n            }\n        });\n    });\n};\n\nconst placeVisibleMarker = () => {\n    const visibleImageWrapper = document.querySelector('[id^=\"map-imagewrapper-\"]:not(.hidden)');\n\n    if (visibleImageWrapper) {\n        const mapId = getMapId(visibleImageWrapper.id);\n        placeImageMarker(mapId);\n    }\n};\n\nconst getVisibleImage = (): HTMLElement | null => {\n    const visibleImageWrapper = document.querySelector('[id^=\"map-imagewrapper-\"]:not(.hidden)');\n\n    if (visibleImageWrapper) {\n        const mapId = getMapId(visibleImageWrapper.id);\n        return document.querySelector(`#map-image-${mapId}`);\n    }\n\n    return null;\n};\n\nconst showResetZoomButton = () => {\n    const resetButton = document.getElementById('reset-zoom-button');\n\n    if (!resetButton) {\n        throw new Error('Reset button is missing');\n    }\n\n    resetButton.classList.remove('hidden');\n};\n\nconst hideResetZoomButton = () => {\n    const resetButton = document.getElementById('reset-zoom-button');\n\n    if (!resetButton) {\n        throw new Error('Reset button is missing');\n    }\n\n    resetButton.classList.add('hidden');\n};\n\nconst setZoomAndPanListeners = (): void => {\n    const mapImages = document.querySelectorAll('[id^=map-imagewrapper-]');\n\n    mapImages.forEach((mapImageElement) => {\n        if (!(mapImageElement instanceof HTMLDivElement)) {\n            throw new Error('element with `map-imagewrapper-` id is not a div element');\n        }\n\n        // Set transform-origin to left/top of the image-wrapper\n\n        let activeTransform = false;\n        let panning = false;\n        let scale = 1;\n        let pointX = 0;\n        let pointY = 0;\n        let startX = 0;\n        let startY = 0;\n\n        const setTransform = () => {\n            mapImageElement.style.transform = `translate(${pointX}px, ${pointY}px) scale(${scale})`;\n        };\n\n        mapImageElement.onmousedown = (event) => {\n            event.preventDefault();\n            const { clientX, clientY } = event;\n\n            startX = clientX - pointX;\n            startY = clientY - pointY;\n\n            panning = true;\n        };\n\n        mapImageElement.onmouseup = () => {\n            panning = false;\n        };\n\n        mapImageElement.onmousemove = (event) => {\n            event.preventDefault();\n\n            if (!panning) {\n                return;\n            }\n\n            if (!activeTransform) {\n                showResetZoomButton();\n                activeTransform = true;\n            }\n\n            const { clientX, clientY } = event;\n\n            pointX = clientX - startX;\n            pointY = clientY - startY;\n            setTransform();\n        };\n\n        mapImageElement.onwheel = (event) => {\n            event.preventDefault();\n\n            if (!activeTransform) {\n                showResetZoomButton();\n                activeTransform = true;\n            }\n\n            const { clientX, clientY, deltaY } = event;\n\n            const xs = (clientX - pointX) / scale;\n            const ys = (clientY - pointY) / scale;\n            const delta = -deltaY;\n\n            const maxWheelDown = 6;\n            const maxWheelUp = 2;\n            const scaleFactor = 1.2;\n\n            if (delta > 0) {\n                scale = clamp(\n                    scale * scaleFactor,\n                    1 / scaleFactor ** maxWheelUp,\n                    scaleFactor ** maxWheelDown,\n                );\n            } else {\n                scale = clamp(\n                    scale / scaleFactor,\n                    1 / scaleFactor ** maxWheelUp,\n                    scaleFactor ** maxWheelDown,\n                );\n            }\n\n            pointX = clientX - xs * scale;\n            pointY = clientY - ys * scale;\n\n            setTransform();\n        };\n\n        const reset = () => {\n            panning = false;\n            scale = 1;\n            pointX = 0;\n            pointY = 0;\n            startX = 0;\n            startY = 0;\n\n            setTransform();\n\n            hideResetZoomButton();\n\n            activeTransform = false;\n        };\n\n        window.addEventListener('resize', reset);\n\n        const mapButtons = document.querySelectorAll('input[name=\"map-selector\"]');\n        mapButtons.forEach((element) => {\n            element.addEventListener('change', reset);\n        });\n\n        const resetButton = document.getElementById('reset-zoom-button');\n\n        if (!resetButton) {\n            throw new Error('Reset button is missing');\n        }\n\n        resetButton.addEventListener('click', reset);\n    });\n};\n\nconst initMarkerPage = (): void => {\n    placeVisibleMarker();\n\n    setZoomAndPanListeners();\n\n    window.addEventListener('resize', () => {\n        placeVisibleMarker();\n    });\n\n    setMapSelectorListeners();\n};\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    const visibleImage = getVisibleImage();\n\n    if (visibleImage === null || !(visibleImage instanceof HTMLImageElement)) {\n        throw new Error('No Image Available on Marker page');\n    }\n\n    if (visibleImage.complete) {\n        initMarkerPage();\n    } else {\n        visibleImage.addEventListener('load', () => {\n            initMarkerPage();\n        });\n    }\n});\n"],
  "mappings": "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",
  "names": []
}
