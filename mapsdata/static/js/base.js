(()=>{var m="index",p="name",E="href";var I=(t,e)=>{if(e==="book")return`/books/${t}/`;if(e==="map")return`/maps/${t}/`;if(e!=="region"&&e!=="city")throw new Error("Unexpected search result type");return`/places/${t}/`},w=(t,e)=>t.replace(new RegExp(`(${e})`,"gi"),'<span class="font-extrabold text-gray-800">$1</span>'),L=(t,e,r)=>{let{name:n,short_name:o,type:u}=t,f=I(o,u),c=document.createElement("div");c.classList.add("flex","flex-col","p-2","text-md","hover:bg-gray-200"),c.setAttribute(`data-${m}`,String(r)),c.setAttribute(`data-${p}`,o),c.setAttribute(`data-${E}`,f);let s=document.createElement("a");s.href=f,s.classList.add("flex","flex-row");let a=document.createElement("p");a.innerHTML=w(n,e),a.classList.add("w-3/4");let T=document.createElement("p");return T.innerHTML=u,T.classList.add("w-1/4","opacity-50","text-right"),s.appendChild(a),s.appendChild(T),c.appendChild(s),c},x=()=>{let t=document.createElement("div");t.classList.add("p-2","text-md","w-full");let e=document.createElement("p");return e.innerHTML="No Results",t.appendChild(e),t};var R="focus-result",g=[R,"bg-gray-200","text-gray-800"],d=()=>{let t=document.querySelector(`.${R}`);if(t instanceof HTMLElement){let e=t.dataset[m],r=t.dataset[p],n=t.dataset[E];if(r&&e&&n)return{focusName:r,focusIndex:parseInt(e),focusHref:n};throw new Error("Focussed Result had unexpected format")}return{focusName:"",focusIndex:0,focusHref:""}},l=t=>{let e=document.querySelector(`[data-index="${t}"]`);e!==null&&e.classList.remove(...g)},i=t=>{let e=document.querySelector(`[data-index="${t}"]`);e!==null&&e.classList.add(...g)};var h=(t,e)=>{if(!(t.target instanceof HTMLInputElement))throw new Error("Unexpected target of search input event.");let{value:r}=t.target,{focusName:n}=d(),{entries:o}=window.malazan;if(e.innerHTML="",r.length>0){let u=o.filter(({name:s})=>s.match(new RegExp(r,"i"))),f=u.slice(0,9).map((s,a)=>L(s,r,a)),c=f.length>0;if(c){f.forEach(a=>e.appendChild(a));let s=u.findIndex(({short_name:a})=>a===n);s>-1&&i(s),s===-1&&i(0)}if(!c){let s=x();e.appendChild(s)}e.classList.remove("hidden")}r.length===0&&e.classList.add("hidden")},S=(t,e)=>{let{key:r}=t;if(r==="ArrowDown"){t.preventDefault();let{focusIndex:n}=d(),o=e.children.length-1;n<o&&(l(n),i(n+1)),n===o&&(l(n),i(0))}if(r==="ArrowUp"){t.preventDefault();let{focusIndex:n}=d(),o=e.children.length-1;n>0&&(l(n),i(n-1)),n===0&&(l(n),i(o))}if(r==="Enter"){t.preventDefault();let{focusHref:n}=d();window.location.href=n}if(r==="Tab"){let{focusIndex:n}=d();l(n)}};document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("search-wrapper"),e=document.getElementById("search"),r=document.getElementById("search-results");if(!(t instanceof HTMLElement))throw new Error("SearchboxWrapper is unexpectedly missing");if(!(e instanceof HTMLInputElement))throw new Error("Searchbox is unexpectedly missing");if(!(r instanceof HTMLElement))throw new Error("SearchResultsBox is unexpectedly missing");e.addEventListener("input",n=>h(n,r)),e.addEventListener("focus",n=>h(n,r)),e.addEventListener("keydown",n=>S(n,r)),t.addEventListener("focusout",n=>{let o=n.relatedTarget;o===null&&r.classList.add("hidden"),o instanceof HTMLElement&&!o.matches("#search-wrapper *")&&r.classList.add("hidden")})});})();
