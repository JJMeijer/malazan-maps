{
  "version": 3,
  "sources": ["../../src/ts/search/constants.ts", "../../src/ts/search/result-element.ts", "../../src/ts/search/result-focus.ts", "../../src/ts/search/search.ts", "../../src/ts/base.ts"],
  "sourcesContent": ["export const RESULT_INDEX_ATTRIBUTE = 'index';\nexport const RESULT_NAME_ATTRIBUTE = 'name';\nexport const RESULT_HREF_ATTRIBUTE = 'href';\n", "import { RESULT_HREF_ATTRIBUTE, RESULT_INDEX_ATTRIBUTE, RESULT_NAME_ATTRIBUTE } from './constants';\nimport { ResultData } from './types';\n\nconst generateLink = (short_name: string, type: string): string => {\n    if (type === 'book') {\n        return `/books/${short_name}`;\n    }\n\n    return `/places/${short_name}`;\n};\n\nconst partialBoldString = (fullText: string, boldText: string): string => {\n    return fullText.replace(\n        new RegExp(`(${boldText})`, 'gi'),\n        `<span class=\"font-extrabold text-gray-800\">$1</span>`,\n    );\n};\n\nexport const createSearchResult = (\n    resultData: ResultData,\n    query: string,\n    index: number,\n): HTMLElement => {\n    const { name, short_name, type } = resultData;\n    const resultHref = generateLink(short_name, type);\n\n    const resultWrapper = document.createElement('div');\n    resultWrapper.classList.add('flex', 'flex-col', 'p-2', 'text-md', 'hover:bg-gray-200');\n    resultWrapper.setAttribute(`data-${RESULT_INDEX_ATTRIBUTE}`, String(index));\n    resultWrapper.setAttribute(`data-${RESULT_NAME_ATTRIBUTE}`, short_name);\n    resultWrapper.setAttribute(`data-${RESULT_HREF_ATTRIBUTE}`, resultHref);\n\n    const resultLink = document.createElement('a');\n    resultLink.href = resultHref;\n    resultLink.classList.add('flex', 'flex-row');\n\n    const resultName = document.createElement('p');\n    resultName.innerHTML = partialBoldString(name, query);\n    resultName.classList.add('w-3/4');\n\n    const resultType = document.createElement('p');\n    resultType.innerHTML = type;\n    resultType.classList.add('w-1/4', 'opacity-50', 'text-right');\n\n    resultLink.appendChild(resultName);\n    resultLink.appendChild(resultType);\n    resultWrapper.appendChild(resultLink);\n\n    return resultWrapper;\n};\n\nexport const createNoResult = (): HTMLElement => {\n    const wrapper = document.createElement('div');\n    wrapper.classList.add(...['p-2', 'text-md', 'w-full']);\n\n    const text = document.createElement('p');\n    text.innerHTML = 'No Results';\n\n    wrapper.appendChild(text);\n\n    return wrapper;\n};\n", "import { RESULT_INDEX_ATTRIBUTE, RESULT_NAME_ATTRIBUTE, RESULT_HREF_ATTRIBUTE } from './constants';\nimport { FocusResultInformation } from './types';\n\nconst FOCUS_RESULT_CLASS = 'focus-result';\n\nconst FOCUS_CLASSES = [FOCUS_RESULT_CLASS, 'bg-gray-200', 'text-gray-800'];\n\nexport const getCurrentFocusResult = (): FocusResultInformation => {\n    const element = document.querySelector(`.${FOCUS_RESULT_CLASS}`);\n\n    if (element instanceof HTMLElement) {\n        const focusIndex = element.dataset[RESULT_INDEX_ATTRIBUTE];\n        const focusName = element.dataset[RESULT_NAME_ATTRIBUTE];\n        const focusHref = element.dataset[RESULT_HREF_ATTRIBUTE];\n\n        if (focusName && focusIndex && focusHref) {\n            return {\n                focusName,\n                focusIndex: parseInt(focusIndex),\n                focusHref,\n            };\n        }\n\n        throw new Error('Focussed Result had unexpected format');\n    }\n\n    return {\n        focusName: '',\n        focusIndex: 0,\n        focusHref: '',\n    };\n};\n\nexport const unSetFocusResult = (resultIndex: number): void => {\n    const element = document.querySelector(`[data-index=\"${resultIndex}\"]`);\n\n    if (element !== null) {\n        element.classList.remove(...FOCUS_CLASSES);\n    }\n};\n\nexport const setFocusResult = (resultIndex: number): void => {\n    const element = document.querySelector(`[data-index=\"${resultIndex}\"]`);\n\n    if (element !== null) {\n        element.classList.add(...FOCUS_CLASSES);\n    }\n};\n", "import { createSearchResult, createNoResult } from './result-element';\nimport { getCurrentFocusResult, setFocusResult, unSetFocusResult } from './result-focus';\n\nexport const handleSearchInput = (event: Event, searchResultsBox: HTMLElement): void => {\n    if (!(event.target instanceof HTMLInputElement)) {\n        throw new Error('Unexpected target of search input event.');\n    }\n\n    const { value } = event.target;\n    const { focusName } = getCurrentFocusResult();\n    const { entries } = window.malazan;\n\n    searchResultsBox.innerHTML = '';\n\n    if (value.length > 0) {\n        const results = entries.filter(({ name }) => {\n            return name.match(new RegExp(value, 'i'));\n        });\n\n        const resultElements = results.slice(0, 9).map((result, index) => {\n            return createSearchResult(result, value, index);\n        });\n\n        const HAS_RESULT = resultElements.length > 0;\n\n        if (HAS_RESULT) {\n            resultElements.forEach((element) => searchResultsBox.appendChild(element));\n\n            const recycledResultFocusIndex = results.findIndex(\n                ({ short_name }) => short_name === focusName,\n            );\n\n            if (recycledResultFocusIndex > -1) {\n                setFocusResult(recycledResultFocusIndex);\n            }\n\n            if (recycledResultFocusIndex === -1) {\n                setFocusResult(0);\n            }\n        }\n\n        if (!HAS_RESULT) {\n            const noResultElement = createNoResult();\n            searchResultsBox.appendChild(noResultElement);\n        }\n\n        searchResultsBox.classList.remove('hidden');\n    }\n\n    if (value.length === 0) {\n        searchResultsBox.classList.add('hidden');\n    }\n};\n\nexport const handleSearchKeys = (event: KeyboardEvent, searchResultsBox: HTMLElement): void => {\n    const { key } = event;\n\n    if (key === 'ArrowDown') {\n        event.preventDefault();\n        const { focusIndex } = getCurrentFocusResult();\n\n        const maxResultIndex = searchResultsBox.children.length - 1;\n\n        if (focusIndex < maxResultIndex) {\n            unSetFocusResult(focusIndex);\n            setFocusResult(focusIndex + 1);\n        }\n\n        if (focusIndex === maxResultIndex) {\n            unSetFocusResult(focusIndex);\n            setFocusResult(0);\n        }\n    }\n\n    if (key === 'ArrowUp') {\n        event.preventDefault();\n        const { focusIndex } = getCurrentFocusResult();\n\n        const maxResultIndex = searchResultsBox.children.length - 1;\n\n        if (focusIndex > 0) {\n            unSetFocusResult(focusIndex);\n            setFocusResult(focusIndex - 1);\n        }\n\n        if (focusIndex === 0) {\n            unSetFocusResult(focusIndex);\n            setFocusResult(maxResultIndex);\n        }\n    }\n\n    if (key === 'Enter') {\n        event.preventDefault();\n        const { focusHref } = getCurrentFocusResult();\n\n        window.location.href = focusHref;\n    }\n\n    if (key === 'Tab') {\n        const { focusIndex } = getCurrentFocusResult();\n        unSetFocusResult(focusIndex);\n    }\n};\n", "import { handleSearchInput, handleSearchKeys } from './search/search';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    const searchBoxWrapper = document.getElementById('search-wrapper');\n    const searchBox = document.getElementById('search');\n    const searchResultsBox = document.getElementById('search-results');\n\n    if (!(searchBoxWrapper instanceof HTMLElement)) {\n        throw new Error('SearchboxWrapper is unexpectedly missing');\n    }\n\n    if (!(searchBox instanceof HTMLInputElement)) {\n        throw new Error('Searchbox is unexpectedly missing');\n    }\n\n    if (!(searchResultsBox instanceof HTMLElement)) {\n        throw new Error('SearchResultsBox is unexpectedly missing');\n    }\n\n    searchBox.addEventListener('input', (event) => handleSearchInput(event, searchResultsBox));\n    searchBox.addEventListener('focus', (event) => handleSearchInput(event, searchResultsBox));\n    searchBox.addEventListener('keydown', (event) => handleSearchKeys(event, searchResultsBox));\n\n    searchBoxWrapper.addEventListener('focusout', (event) => {\n        const relatedTarget = event.relatedTarget;\n        if (relatedTarget === null) {\n            searchResultsBox.classList.add('hidden');\n        }\n\n        if (relatedTarget instanceof HTMLElement && !relatedTarget.matches('#search-wrapper *')) {\n            searchResultsBox.classList.add('hidden');\n        }\n    });\n});\n"],
  "mappings": "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",
  "names": []
}
