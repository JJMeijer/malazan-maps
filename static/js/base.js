(()=>{var p="index",E="name",T="href",R=10;var _=(t,e)=>{if(e==="book")return`/books/${t}/`;if(e==="map")return`/maps/${t}/`;if(e!=="region"&&e!=="city")throw new Error("Unexpected search result type");return`/places/${t}/`},y=(t,e)=>t.replace(new RegExp(`(${e})`,"gi"),'<span class="font-extrabold text-gray-800">$1</span>'),g=(t,e,r)=>{let{name:n,short_name:o,type:m}=t,f=_(o,m),a=document.createElement("div");a.classList.add("flex","flex-col","p-2","text-md","hover:bg-gray-200"),a.setAttribute(`data-${p}`,String(r)),a.setAttribute(`data-${E}`,o),a.setAttribute(`data-${T}`,f);let i=document.createElement("a");i.href=f,i.classList.add("flex","flex-row");let s=document.createElement("p");s.innerHTML=y(n,e),s.classList.add("w-3/4");let c=document.createElement("p");return c.innerHTML=m,c.classList.add("w-1/4","opacity-50","text-right"),i.appendChild(s),i.appendChild(c),a.appendChild(i),a},S=()=>{let t=document.createElement("div");t.classList.add("p-2","text-md","w-full");let e=document.createElement("p");return e.innerHTML="No Results",t.appendChild(e),t};var I="focus-result",w=[I,"bg-gray-200","text-gray-800"],l=()=>{let t=document.querySelector(`.${I}`);if(t instanceof HTMLElement){let e=t.dataset[p],r=t.dataset[E],n=t.dataset[T];if(r&&e&&n)return{focusName:r,focusIndex:parseInt(e),focusHref:n};throw new Error("Focussed Result had unexpected format")}return{focusName:"",focusIndex:0,focusHref:""}},u=t=>{let e=document.querySelector(`[data-index="${t}"]`);e!==null&&e.classList.remove(...w)},d=t=>{let e=document.querySelector(`[data-index="${t}"]`);e!==null&&e.classList.add(...w)};var L=(t,e)=>{if(!(t.target instanceof HTMLInputElement))throw new Error("Unexpected target of search input event.");let{value:r}=t.target,{focusName:n,focusIndex:o}=l(),{entries:m}=window.malazan;if(e.innerHTML="",r.length>0){let f=m.filter(({name:s})=>s.match(new RegExp(r,"i"))).sort(({name:s},{name:c})=>{let x=s.toLowerCase().indexOf(r.toLowerCase()),h=c.toLowerCase().indexOf(r.toLowerCase());return x<h?-1:x>h?1:0}),a=f.slice(0,R-1).map((s,c)=>g(s,r,c)),i=a.length>0;if(i){a.forEach(c=>e.appendChild(c));let s=f.findIndex(({short_name:c})=>c===n);s>-1&&s<=o?d(s):d(0)}if(!i){let s=S();e.appendChild(s)}e.classList.remove("hidden")}r.length===0&&e.classList.add("hidden")},U=(t,e)=>{let{key:r}=t;if(r==="ArrowDown"){t.preventDefault();let{focusIndex:n}=l(),o=e.children.length-1;n<o&&(u(n),d(n+1)),n===o&&(u(n),d(0))}if(r==="ArrowUp"){t.preventDefault();let{focusIndex:n}=l(),o=e.children.length-1;n>0&&(u(n),d(n-1)),n===0&&(u(n),d(o))}if(r==="Enter"){t.preventDefault();let{focusHref:n}=l();window.location.href=n}if(r==="Tab"){let{focusIndex:n}=l();u(n)}};document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("search-wrapper"),e=document.getElementById("search"),r=document.getElementById("search-results");if(!(t instanceof HTMLElement))throw new Error("SearchboxWrapper is unexpectedly missing");if(!(e instanceof HTMLInputElement))throw new Error("Searchbox is unexpectedly missing");if(!(r instanceof HTMLElement))throw new Error("SearchResultsBox is unexpectedly missing");e.addEventListener("input",n=>L(n,r)),e.addEventListener("focus",n=>L(n,r)),e.addEventListener("keydown",n=>U(n,r)),t.addEventListener("focusout",n=>{let o=n.relatedTarget;o===null&&r.classList.add("hidden"),o instanceof HTMLElement&&!o.matches("#search-wrapper *")&&r.classList.add("hidden")})});})();
