(()=>{var m="index",p="name",E="href";var I=(t,e)=>e==="book"?`/books/${t}/`:`/places/${t}/`,w=(t,e)=>t.replace(new RegExp(`(${e})`,"gi"),'<span class="font-extrabold text-gray-800">$1</span>'),L=(t,e,s)=>{let{name:n,short_name:o,type:u}=t,f=I(o,u),c=document.createElement("div");c.classList.add("flex","flex-col","p-2","text-md","hover:bg-gray-200"),c.setAttribute(`data-${m}`,String(s)),c.setAttribute(`data-${p}`,o),c.setAttribute(`data-${E}`,f);let r=document.createElement("a");r.href=f,r.classList.add("flex","flex-row");let a=document.createElement("p");a.innerHTML=w(n,e),a.classList.add("w-3/4");let T=document.createElement("p");return T.innerHTML=u,T.classList.add("w-1/4","opacity-50","text-right"),r.appendChild(a),r.appendChild(T),c.appendChild(r),c},x=()=>{let t=document.createElement("div");t.classList.add("p-2","text-md","w-full");let e=document.createElement("p");return e.innerHTML="No Results",t.appendChild(e),t};var R="focus-result",g=[R,"bg-gray-200","text-gray-800"],i=()=>{let t=document.querySelector(`.${R}`);if(t instanceof HTMLElement){let e=t.dataset[m],s=t.dataset[p],n=t.dataset[E];if(s&&e&&n)return{focusName:s,focusIndex:parseInt(e),focusHref:n};throw new Error("Focussed Result had unexpected format")}return{focusName:"",focusIndex:0,focusHref:""}},l=t=>{let e=document.querySelector(`[data-index="${t}"]`);e!==null&&e.classList.remove(...g)},d=t=>{let e=document.querySelector(`[data-index="${t}"]`);e!==null&&e.classList.add(...g)};var h=(t,e)=>{if(!(t.target instanceof HTMLInputElement))throw new Error("Unexpected target of search input event.");let{value:s}=t.target,{focusName:n}=i(),{entries:o}=window.malazan;if(e.innerHTML="",s.length>0){let u=o.filter(({name:r})=>r.match(new RegExp(s,"i"))),f=u.slice(0,9).map((r,a)=>L(r,s,a)),c=f.length>0;if(c){f.forEach(a=>e.appendChild(a));let r=u.findIndex(({short_name:a})=>a===n);r>-1&&d(r),r===-1&&d(0)}if(!c){let r=x();e.appendChild(r)}e.classList.remove("hidden")}s.length===0&&e.classList.add("hidden")},S=(t,e)=>{let{key:s}=t;if(s==="ArrowDown"){t.preventDefault();let{focusIndex:n}=i(),o=e.children.length-1;n<o&&(l(n),d(n+1)),n===o&&(l(n),d(0))}if(s==="ArrowUp"){t.preventDefault();let{focusIndex:n}=i(),o=e.children.length-1;n>0&&(l(n),d(n-1)),n===0&&(l(n),d(o))}if(s==="Enter"){t.preventDefault();let{focusHref:n}=i();window.location.href=n}if(s==="Tab"){let{focusIndex:n}=i();l(n)}};document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("search-wrapper"),e=document.getElementById("search"),s=document.getElementById("search-results");if(!(t instanceof HTMLElement))throw new Error("SearchboxWrapper is unexpectedly missing");if(!(e instanceof HTMLInputElement))throw new Error("Searchbox is unexpectedly missing");if(!(s instanceof HTMLElement))throw new Error("SearchResultsBox is unexpectedly missing");e.addEventListener("input",n=>h(n,s)),e.addEventListener("focus",n=>h(n,s)),e.addEventListener("keydown",n=>S(n,s)),t.addEventListener("focusout",n=>{let o=n.relatedTarget;o===null&&s.classList.add("hidden"),o instanceof HTMLElement&&!o.matches("#search-wrapper *")&&s.classList.add("hidden")})});})();
